{% extends 'restaurant/base.html' %}

{% block title %}
Профиль {{ user.email }}
{% endblock %}

{% block content %}
<main class="bg-dark text-white" style="min-height: 100vh;">
    <div class="text-center mt-5 p-5">
        <h1>
            Резервы на сегодня
        </h1>
    </div>
    <div class="container">
        <form method="get" class="mb-3 d-flex align-items-center gap-3 flex-wrap">
            <div>
                <label for="date">Выберите дату:</label>
                <input type="date" id="date" name="date" value="{{ request.GET.date|default_if_none:'' }}">
            </div>

            <div>
                <label for="table_number">Номер столика:</label>
                <input type="number" id="table_number" name="table_number" min="1" value="{{ request.GET.table_number|default_if_none:'' }}" style="width: 80px;">
            </div>

            <button type="submit" class="btn btn-primary btn-sm">Показать</button>

            {% if request.GET.date or request.GET.table_number %}
                <a href="{% url 'restaurant:reservation_list' %}" class="btn btn-secondary btn-sm">Сбросить</a>
            {% endif %}
        </form>
        <div class="row">
            <div class="col-12">
                <table class="table table-dark caption-top">
                    <caption>
                        Список активных резервов
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-card-list" viewBox="0 0 16 16">
                          <path d="M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2z"/>
                          <path d="M5 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 5 8m0-2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5m0 5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5m-1-5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0M4 8a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0m0 2.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0"/>
                        </svg>
                    </caption>
                  <thead>
                    <tr>
                      <th scope="col">#</th>
                      <th scope="col">Гость</th>
                      <th scope="col">Дата</th>
                      <th scope="col">Время</th>
                      <th scope="col">Столик</th>
                      <th scope="col">Количество мест</th>
                      <th scope="col">Комментарий</th>
                      <th scope="col">Изменить</th>
                      <th scope="col">Отменить</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for reservation in object_list %}
                    <tr>
                      <th scope="row">{{ forloop.counter }}</th>
                      <td>{{ reservation.owner }}</td>
                      <td>{{ reservation.date|date:"d.m.Y" }}</td>
                      <td>{{ reservation.time|time:"H:i" }}</td>
                      <td>{{ reservation.table.number }}</td>
                      <td>{{ reservation.table.number_of_seats }}</td>
                      <td>{{ reservation.comment|default:"-" }}</td>
                      <td>
                          <a href="{% url 'restaurant:reservation_update' pk=reservation.pk %}" class="btn btn-sm btn-primary">Изменить</a>
                      </td>
                      <td>
                          <a href="{% url 'restaurant:reservation_delete' pk=reservation.pk %}" class="btn btn-sm btn-danger">Отменить</a>
                      </td>
                    </tr>
                    {% empty %}
                    <tr>
                      <td colspan="9" class="text-center">На сегодня бронь отсутсвует.</td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
                <div class="d-flex justify-content-center mt-4">
                    <nav aria-label="Page navigation">
                        <ul class="pagination">
                            {% if page_obj.has_previous %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if request.GET.date %}&date={{ request.GET.date }}{% endif %}{% if request.GET.table_number %}&table_number={{ request.GET.table_number }}{% endif %}" aria-label="Previous">
                                        <span aria-hidden="true">&laquo;</span>
                                    </a>
                                </li>
                            {% else %}
                                <li class="page-item disabled">
                                    <span class="page-link">&laquo;</span>
                                </li>
                            {% endif %}

                            {% for num in page_obj.paginator.page_range %}
                                {% if page_obj.number == num %}
                                    <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                                {% else %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ num }}{% if request.GET.date %}&date={{ request.GET.date }}{% endif %}{% if request.GET.table_number %}&table_number={{ request.GET.table_number }}{% endif %}">{{ num }}</a>
                                    </li>
                                {% endif %}
                            {% endfor %}

                            {% if page_obj.has_next %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if request.GET.date %}&date={{ request.GET.date }}{% endif %}{% if request.GET.table_number %}&table_number={{ request.GET.table_number }}{% endif %}" aria-label="Next">
                                        <span aria-hidden="true">&raquo;</span>
                                    </a>
                                </li>
                            {% else %}
                                <li class="page-item disabled">
                                    <span class="page-link">&raquo;</span>
                                </li>
                            {% endif %}
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</main>
{% endblock %}